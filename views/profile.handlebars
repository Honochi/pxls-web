<!doctype html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>{{user.name}} - {{title}}</title>
    <link rel="stylesheet" href="/profile/css/theme-purple.min.css">
    <link rel="stylesheet" href="/fontawesome-all.min.css">
    <link rel="stylesheet" href="/profile/css/views/index.css">
    <link rel="stylesheet" href="/SLIDEIN.css">
    <script src="/jquery-3.4.1.min.js"></script>
    <script src="/profile/js/bootstrap.bundle.min.js"></script>
    <script src="/crel.min.js"></script>
    <script src="/SLIDEIN.js"></script>
    {{#if isSelf}}
    {{! no reason to add even more network bloat. we only need spectrum if we're modifying factions and factions are only modifiable on our own profile. }}
    <link rel="stylesheet" href="/profile/css/spectrum.css">
    <script src="/profile/js/spectrum-min.js"></script>
    {{/if}}
</head>
<body data-palette="{{#if palette}}{{palette}}{{/if}}" data-faction-max-tag="{{maxFactionTagLength}}" data-faction-max-name="{{maxFactionNameLength}}">
<nav class="navbar navbar-dark navbar-expand-md" role="nav">
    <ul class="navbar-nav mr-auto">
        <li class="nav-item">
            <a href="/" class="nav-link">{{title}}</a>
        </li>
        <li class="nav-item active">
            {{! 例如 "Alice的个人资料" }}
            <a href="{{routeRoot}}" class="nav-link">{{i18n '{0}的个人资料' user.name}}</a>
        </li>
    </ul>
    {{#if self}}
    <div class="my-2 my-lg-0">
        <div class="dropdown">
            <button class="navbar-text btn btn-link dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false" aria-haspopup="true" id="btnNavUserDropdown">
                <i class="fas fa-user-alt mr-1"></i>{{self.name}}
            </button>
            <div class="dropdown-menu dropdown-menu-right" id="navUserDropdown" aria-labelledby="btnNavUserDropdown">
                <a href="/profile?action=details" class="dropdown-item">{{i18n '我的资料'}}</a>
                <a href="/profile?action=factions" class="dropdown-item">{{i18n '我的阵营'}}</a>
                <a href="/profile?action=data" class="dropdown-item">{{i18n '我的数据'}}</a>
            </div>
        </div>
    </div>
    {{/if}}
</nav>
<main role="main" class="mb-3">
    <div class="container">
        <h1>{{#with (displayedFaction)}}[{{tag}}] {{/with}}{{i18n '{0}的个人资料' user.name}}</h1>
        <hr>
        <div class="row">
            <div class="col-md-3">
                <div class="list-group" id="tabsTriggers">
                    <a href="{{routeRoot}}?action=details" data-action="details" class="list-group-item text-light active">
                        <i class="fas fa-id-card mr-2 d-none d-md-inline-block"></i>{{i18n '信息'}}
                    </a>
                    {{#if isSelf}}
                    <a href="{{routeRoot}}?action=reports" class="list-group-item text-light" data-action="reports">
                        <i class="fas fa-flag mr-2 d-none d-md-inline-block"></i>{{i18n '举报'}}
                    </a>
                    <a href="{{routeRoot}}?action=factions" class="list-group-item text-light" data-action="factions">
                        <i class="fas fa-users mr-2 d-none d-md-inline-block"></i>{{i18n '阵营'}}
                    </a>
                    <a href="{{routeRoot}}?action=data" class="list-group-item text-light" data-action="data">
                        <i class="fas fa-key mr-2 d-none d-md-inline-block"></i>{{i18n '数据'}}
                    </a>
                    {{/if}}
                </div>
            </div>
            <div class="col-md-9 tab-content mt-3 mt-md-0" id="tabsWrapper">
                <div id="tab-details" class="tab-pane text-center active" data-tab="details">
                    {{#unless user}}
                    <p class="text-warning text-center">{{i18n '您必须登录才能查看您的个人资料。'}}</p>
                    {{else}}
                    <h3>{{user.username}}</h3>
                    <table class="inline-block">
                        <tbody>
                        <tr>
                            <th class="text-right pr-3">{{i18n '注册日期'}}</th>
                            <td class="text-left">
                                <time datetime={{isoTime user.signupTime}}>
                                    {{user.signupTimeFormatted}}
                                </time>
                            </td>
                        </tr>
                        {{#unless snipMode}}
                        <tr>
                            <th class="text-right pr-3">{{i18n '总像素数'}}</th>
                            <td class="text-left number">{{user.pixelCountAllTime}}</td>
                        </tr>
                        <tr>
                            <th class="text-right pr-3">{{i18n '当前画布像素数'}}</th>
                            <td class="text-left number">{{user.pixelCount}}</td>
                        </tr>
                        {{/unless}}
                        <tr>
                            <th class="text-right pr-3">{{i18n 'Discord 标签'}}</th>
                            <td class="text-left">{{default user.discordName "未设置"}}</td>
                        </tr>
                        <tr>
                            <th class="text-right pr-3">{{i18n '阵营'}}</th>
                            {{#if (displayedFaction)}}
                            <td class="text-left">{{#with (displayedFaction)}}[{{tag}}] {{name}} (ID: {{id}}){{/with}}</td>
                            {{else}}
                            <td class="text-left text-muted">({{i18n '无'}})</td>
                            {{/if}}
                        </tr>
                        <tr>
                            <th class="text-right pr-3">{{i18n '角色'}}</th>
                            <td class="text-left">
                                {{#if user.roles}}
                                <ul class="roles">
                                {{#each user.roles}}<li>{{#each this.badges}}<i class="{{this.cssIcon}}"></i> {{/each}}{{this.name}}</li>{{/each}}
                                </ul>
                                {{else}}
                                <span class="text-muted">({{i18n '无'}})</span>
                                {{/if}}
                            </td>
                        </tr>
                        {{#if user.isBanned}}
                        <tr>
                            <th class="text-right pr-3">{{i18n '画布封禁到期'}}</th>
                            <td class="text-left">
                                {{#if user.isPermaBanned}}
                                {{i18n '永久'}}
                                {{else}}
                                <time datetime={{isoTime user.banExpiry}}>
                                    {{user.banExpiryFormatted}}
                                </time>
                                {{/if}}
                            </td>
                        </tr>
                        {{/if}}
                        {{#if user.isChatBanned}}
                        <tr>
                            <th class="text-right pr-3">{{i18n '聊天封禁到期'}}</th>
                            <td class="text-left">
                                {{#if user.isPermaChatBanned}}
                                {{i18n '永久'}}
                                {{else}}
                                <time datetime={{isoTime user.chatBanExpiry}}>
                                    {{user.chatBanExpiryFormatted}}
                                </time>
                                {{/if}}
                            </td>
                        </tr>
                        {{/if}}
                        </tbody>
                    </table>
                    <div class="d-block mt-4">
                        {{{i18n '查看排名和其他统计信息请点击<a href="/stats">这里</a>。'}}}
                    </div>
                    {{/unless}}
                </div>
                {{#if isSelf}}
                <div id="tab-reports" class="tab-pane" data-tab="reports">
                    {{#unless user}}
                    <p class="text-warning text-center">{{i18n '您必须登录才能查看您的举报。'}}</p>
                    {{else}}
                    <h3 class="text-center">{{i18n '举报'}}</h3>
                    <div class="card collapseable mb-2">
                        <div class="card-header">
                            <button class="btn btn-sm mr-2 btn-info" data-action="collapse"><i class="fas fa-chevron-down"></i></button>
                            <span class="text-info">{{i18n '画布举报（{0}/{1} 个未关闭）' canvasReportsOpenCount (len canvasReports)}}</span>
                        </div>
                        <div class="card-body p-0 body-collapse-target collapse">
                            <div class="p-3">
                                {{#each canvasReports}}
                                <div class="card collapseable mb-2">
                                    <div class="card-header">
                                        <button class="btn btn-sm mr-2 btn-info" data-action="collapse"><i class="fas fa-chevron-down"></i></button>
                                        <span class="{{#if this.closed}}text-success{{else}}text-warning{{/if}}">
                                            {{#if this.closed}}
                                            {{i18n '对 {0} 的举报（已关闭）' this.target}}
                                            {{else}}
                                            {{i18n '对 {0} 的举报（未关闭）' this.target}}
                                            {{/if}}
                                        </span>
                                    </div>
                                    <div class="card-body p-0 body-collapse-target collapse">
                                        <div class="p-3">
                                            <h6>{{i18n '于 {1} 举报了 {0}' this.target (localeDate this.time)}}</h6>
                                            <p>{{this.message}}</p>
                                        </div>
                                    </div>
                                </div>
                                {{/each}}
                                {{#unless canvasReports}}
                                <p>{{i18n '没有可显示的画布举报。'}}</p>
                                {{/unless}}
                            </div>
                        </div>
                    </div>
                    <div class="card collapseable mb-2">
                        <div class="card-header">
                            <button class="btn btn-sm mr-2 btn-info" data-action="collapse"><i class="fas fa-chevron-down"></i></button>
                            <span class="text-info">{{i18n '聊天举报（{0}/{1} 个未关闭）' chatReportsOpenCount (len chatReports)}}</span>
                        </div>
                        <div class="card-body p-0 body-collapse-target collapse">
                            <div class="p-3">
                                {{#each chatReports}}
                                <div class="card collapseable mb-2">
                                    <div class="card-header">
                                        <button class="btn btn-sm mr-2 btn-info" data-action="collapse"><i class="fas fa-chevron-down"></i></button>
                                        <span class="{{#if this.closed}}text-success{{else}}text-warning{{/if}}">
                                            {{#if this.closed}}
                                            {{i18n '对 {0} 的举报（已关闭）' this.target}}
                                            {{else}}
                                            {{i18n '对 {0} 的举报（未关闭）' this.target}}
                                            {{/if}}
                                        </span>
                                    </div>
                                    <div class="card-body p-0 body-collapse-target collapse">
                                        <div class="p-3">
                                            <h6>{{i18n '于 {1} 举报了 {0}' this.target (localeDate this.time)}}</h6>
                                            <p>{{this.message}}</p>
                                        </div>
                                    </div>
                                </div>
                                {{/each}}
                                {{#unless chatReports}}
                                <p>{{i18n '没有可显示的聊天举报。'}}</p>
                                {{/unless}}
                            </div>
                        </div>
                    </div>
                    {{/unless}}
                </div>
                <div id="tab-factions" class="tab-pane" data-tab="factions">
                    {{#unless user}}
                    <p class="text-center text-warning">{{i18n '您必须登录才能管理您的阵营。'}}</p>
                    {{else}}
                        {{#if (or user.isFactionRestricted user.isBanned)}}
                        <small class="text-danger m-0 p-0 d-block">
                            {{#if user.isFactionRestricted}}
                            {{i18n '您已被限制阵营，无法创建新阵营。如有疑问请联系管理员。'}}
                            {{else}}
                            {{i18n '您已被画布封禁，无法创建新阵营。如有疑问请联系管理员。'}}
                            {{/if}}
                        </small>
                        {{/if}}
                    {{/unless}}
                    {{#if (gt (default newFactionMinPixels 0) self.pixelCountAllTime)}}
                    <small class="text-warning m-0 p-0 d-block">{{i18n '您必须拥有至少 {0} 个总像素才能创建阵营。' (default newFactionMinPixels 0)}}</small>
                    {{/if}}
                    <div class="mb-2">
                        <button class="btn btn-success btn-sm mr-1 global-faction-action" data-action="factionCreate" {{#if (or (gt (default newFactionMinPixels 0) self.pixelCountAllTime) user.isFactionRestricted)}}disabled="disabled"{{/if}}><i class="fas fa-plus"></i> {{i18n '创建'}}</button>
                        <button class="btn btn-primary btn-sm mr-1 global-faction-action" data-toggle="modal" data-target="#modal-faction-search"><i class="fas fa-user-plus"></i> {{i18n '加入'}}</button>
                    </div>
                    {{#each user.factions}}
                    <div class="media mb-2 faction-media" data-faction-id="{{this.id}}" data-faction-name="{{this.name}}" data-faction-tag="{{this.tag}}" data-faction-color="{{default this.color 0}}">
                        <span class="media-text-icon mr-3">[{{this.tag}}]</span>
                        <div class="media-body">
                            <h5 class="mt-0 mb-1">
                                {{#if (eq ../user.displayedFactionId this.id)}}
                                <i class="fas fa-eye mr-1 text-success" style="font-size: 0.75em;" title="{{i18n '这是你当前显示的阵营。'}}"></i>
                                {{/if}}
                                {{i18n '{0}（成员数：{1}, ID: {2}）' this.name (len this.members) this.id}}
                            </h5>
                            <div class="mb-1 mt-2">
                                <span class="text-muted">{{i18n '拥有者：{0}' this.ownerName}}</span>
                            </div>
                            <div>
                                {{#if (eq ../user.displayedFactionId this.id)}}
                                <button class="btn btn-info btn-sm mr-1 mt-1 faction-action" data-action="factionRemoveDisplayed"><i class="fas fa-minus mr-1"></i>{{i18n '移除显示'}}</button>
                                {{else}}
                                <button class="btn btn-info btn-sm mr-1 mt-1 faction-action" data-action="factionSetDisplayed"><i class="fas fa-check mr-1"></i>{{i18n '设为显示'}}</button>
                                {{/if}}
                                {{#if (eq this.ownerId ../self.id)}}
                                <button class="btn btn-info btn-sm mr-1 mt-1 faction-action" data-action="factionMembers" data-toggle="modal" data-target="#modal-member-list-{{this.id}}"><i class="fas fa-users mr-1"></i>{{i18n '成员'}}</button>
                                <button class="btn btn-info btn-sm mr-1 mt-1 faction-action" data-action="factionEdit"><i class="fas fa-pencil-alt mr-1"></i>{{i18n '编辑'}}</button>
                                <button class="btn btn-danger btn-sm mr-1 mt-1 faction-action" data-action="factionDelete"><i class="fas fa-times mr-1"></i>{{i18n '删除'}}</button>
                                {{else}}
                                <button class="btn btn-danger btn-sm mr-1 mt-1 faction-action" data-action="factionLeave"><i class="fas fa-sign-out-alt mr-1"></i>{{i18n '退出'}}</button>
                                {{/if}}
                            </div>
                        </div>
                    </div>
                    {{/each}}
                    {{#unless user.factions}}
                    <p class="text-center text-warning">{{i18n '您还没有加入任何阵营！'}}</p>
                    {{/unless}}
                </div>
                <div id="tab-data" class="tab-pane text-center" data-tab="data">
                    {{#unless user}}
                    <p class="text-warning text-center">{{i18n '您必须登录才能查看您的数据。'}}</p>
                    {{else}}
                    <h3>{{i18n '日志密钥'}}</h3>
                    <p><i class="fas fa-info-circle"></i> {{i18n '拥有日志密钥的人可以查看你在之前画布上放置的像素。'}}</p>
                    {{#if keys}}
                    <table class="inline-block table-border-between">
                        <thead>
                        <tr>
                            <th class="text-center pr-3">{{i18n '画布代码'}}</th>
                            <th class="text-center">{{i18n '日志密钥'}}</th>
                        </tr>
                        </thead>
                        <tbody>
                        {{#each keys}}
                        <tr>
                            <td class="text-center pr-3 align-text-top">{{@key}}</td>
                            <td class="text-left"><code class="break">{{this}}</code></td>
                            <td><button type="button" class="btn btn-primary text-light" data-action="copy-log-key"><i class="fas fa-clipboard-list"></i></button></td>
                        </tr>
                        {{/each}}
                        </tbody>
                    </table>
                    {{else}}
                    <p class="text-center text-warning">{{i18n '你还没有日志密钥！'}}</p>
                    <p class="text-center text-warning">{{i18n '当你参与的画布结束后，日志密钥会显示在这里。'}}</p>
                    {{/if}}
                    {{/unless}}
                </div>
                {{/if}}
            </div>
        </div>
    </div>
</main>
{{#if isSelf}}
{{#each user.factions}}
{{#if (eq this.ownerId ../user.id)}}
<div class="modal fade member-list-modal" id="modal-member-list-{{this.id}}" data-faction-id="{{this.id}}" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{{i18n '{0}（[{1}]）的成员' this.name this.tag}}</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="{{i18n '关闭'}}">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="card collapseable mb-2">
                    <div class="card-header">
                        <button class="btn btn-sm mr-2 btn-info" data-action="collapse"><i class="fas fa-chevron-down"></i></button>
                        <span class="text-info">{{i18n '阵营成员'}}</span>
                    </div>
                    <div class="card-body p-0 body-collapse-target collapse">
                        <div class="p-3">
                            {{#if (gt (len this.members) 1)}}
                            {{#each this.members}}
                            {{#if (ne this.id ../../self.id)}}
                            <div class="row member-row mb-1" data-member="{{this.name}}">
                                <div class="col-md-6">
                                    <span><a href="/profile/{{this.name}}" target="_blank">{{this.name}}</a></span>
                                </div>
                                <div class="col-md-6 text-right">
                                    <button class="btn btn-sm btn-success faction-subaction" data-action="transfer">{{i18n '转让拥有者'}}</button>
                                    <button class="btn btn-sm btn-danger faction-subaction" data-action="ban">{{i18n '封禁'}}</button>
                                </div>
                            </div>
                            {{/if}}
                            {{/each}}
                            {{else}}
                            <p class="text-muted text-center mb-0">{{i18n '暂无成员信息！'}}</p>
                            {{/if}}
                        </div>
                    </div>
                </div>
                <div class="card collapseable mb-2">
                    <div class="card-header">
                        <button class="btn btn-sm mr-2 btn-info" data-action="collapse"><i class="fas fa-chevron-down"></i></button>
                        <span class="text-info">{{i18n '阵营封禁'}}</span>
                    </div>
                    <div class="card-body p-0 body-collapse-target collapse">
                        <div class="p-3">
                            {{#each this.bans}}
                            <div class="row member-row mb-1" data-member="{{this.name}}">
                                <div class="col-md-6">
                                    <span>{{this.name}}</span>
                                </div>
                                <div class="col-md-6 text-right">
                                    <button class="btn btn-sm btn-primary faction-subaction" data-action="unban">{{i18n '解除封禁'}}</button>
                                </div>
                            </div>
                            {{/each}}
                            {{#unless this.bans}}
                            <p class="text-muted text-center mb-0">{{i18n '暂无成员信息！'}}</p>
                            {{/unless}}
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">{{i18n '关闭'}}</button>
            </div>
        </div>
    </div>
</div>
{{/if}}
{{/each}}
{{/if}}
<div class="modal fade" id="modal-faction-search" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{{i18n '查找阵营'}}</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="{{i18n '关闭'}}">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form action="#" class="form" id="frmFactionSearch">
                    <div class="form-group">
                        <div class="input-group flex-nowrap">
                            <div class="input-group-prepend">
                                <label class="input-group-text" for="txtFactionSearch">{{i18n '搜索：'}}</label>
                            </div>
                            <input type="text" class="form-control" autocomplete="disabled" id="txtFactionSearch" required>
                            <div class="input-group-append">
                                <button class="btn btn-outline-info" type="submit" id="btnFactionSearch"><i class="fas fa-search"></i></button>
                            </div>
                        </div>
                    </div>
                </form>
                <div id="searchTarget" class="m-0 px-0 py-2">
                    <p class="text-muted text-center">{{i18n '请输入搜索内容以开始。'}}</p>
                </div>
                <button class="btn btn-block btn-sm btn-secondary d-none" id="btnFactionSearchLoadMore">{{i18n '加载更多'}}</button>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">{{i18n '关闭'}}</button>
            </div>
        </div>
    </div>
</div>
<script src="/profile/js/views/root.js"></script>
<script src="/profile/js/views/profile.js"></script>
</body>
</html>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">{{i18n 'Close'}}</button>
            </div>
        </div>
    </div>
</div>
<script src="/profile/js/views/root.js"></script>
<script src="/profile/js/views/profile.js"></script>
</body>
</html>
